# 🎵 m2mm (mid to mobinogi mml)

MIDI(.mid) 파일을 모비노기(모바일 마비노기) MML 형식으로 변환하는 Windows 프로그램

## 📥 다운로드

**[📥 최신 버전 다운로드 (v1.0.0)](https://drive.google.com/file/d/14Nb0norgrl8mTs2qGfhuWRLMVcYDJBh4/view?usp=sharing)**

- Windows 10/11 (64-bit)
- 설치 프로그램 실행 후 바로 사용 가능

---

## 🚀 사용 방법

1. **프로그램 실행**
2. **변환 옵션 선택** (선택사항)
   - 일반 변환 / 악기별 변환
   - 악보 글자 수 제한 (기본 2400자)
3. **MIDI 파일(.mid) 드래그 또는 선택**
4. **변환된 파트의 "MML 복사하기" 버튼 클릭**
5. **게임 내에서 붙여넣기**

## 💡 변환 결과

- **멜로디**: 주 멜로디 라인
- **화음1~5**: 자동으로 분리된 화음 파트
- 각 파트는 독립적으로 복사 가능
- 원본 러닝타임과 변환된 러닝타임 표시

### 글자수 제한에 따른 크롭

- 설정한 글자수를 초과하면 **자동으로 앞부분만 변환**됩니다
- 원본이 3분이어도 2분 30초까지만 변환될 수 있음
- 글자수 제한을 늘리면 더 긴 구간 변환 가능

### 음표 밀도의 영향

동일한 러닝타임(10초)이라도 음표 개수에 따라 글자수가 달라집니다:

- **음표 10개** → 짧은 MML (수십 글자)
- **음표 1000개** → 긴 MML (수천 글자)

**복잡한 곡일수록 글자수 제한에 빨리 도달**하므로 더 짧게 변환됩니다.

---

## ❓ 왜 MP3는 안되고 MIDI만 되나요?

### MIDI = 악보 데이터 📜

- **"어떤 음을, 언제, 얼마나 길게"** 연주하라는 명령어 집합
- 음표 하나하나가 구조화된 정보로 저장됨
- 파일 크기: 수십~수백 KB
- **비유**: 레고 조립 설명서

### MP3 = 소리 파형 🌊

- 실제 공기 진동을 초당 44,100번 기록한 데이터
- 음표 정보가 없음 (단순 진폭 값의 연속)
- 파일 크기: 수 MB~수십 MB
- **비유**: 완성된 레고 사진

### 결론

- **MIDI → MML**: 악보 → 악보 (직접 변환 가능)
- **MP3 → MML**: 소리 → 악보 (매우 부정확하고 어려움)

MP3를 변환하려면 복잡한 신호 처리와 화음 분리가 필요하며, 특히 여러 악기가 섞인 경우 거의 불가능합니다.

---

## 📧 문의

버그 리포트, 기능 제안: **molla202512@gmail.com**

---

## 🔧 개발자를 위한 기술 정보

<details>
<summary>펼치기</summary>

### 기술 스택

- **Backend**: Rust, Tauri v2, midly
- **Frontend**: Svelte 5, TypeScript, Tailwind CSS, DaisyUI

### 변환 원리

#### 1. MIDI 파싱

- `midly` 라이브러리로 MIDI 이벤트 파싱
- TPB(Ticks Per Beat) = 24로 정규화
- 각 노트의 `start`, `end`, `duration`, `velocity`, `instrument` 추출

#### 2. Voice 할당 알고리즘

최대 6개 파트(멜로디 1 + 화음 5)로 자동 분리

**멜로디 선택 규칙**:

- 단일 음표: 비어있는 첫 번째 voice 배정
- 동시 발음: 이전 멜로디와 1옥타브 이내 → 가장 높은 음 선택

**화음 배정 우선순위**:

1. 멜로디 (가장 높은 음)
2. 베이스 (가장 낮은 음)
3. 나머지 (velocity 큰 순서)

#### 3. MML 생성

- 옥타브 자동 계산 (o2~o6)
- 음표 길이 4분음표 기준 변환
- Tempo: `t<BPM>` 형식

**정확도 우선 모드** (기본):

- **점음표 적극 활용** (`1.`, `2.`, `4.`, `8.` 등)
- **타이(&) 연결**로 원본 타이밍 정확히 재현
  - 예: 정확히 매칭 안 되면 `c4&c8` 형태로 분할
- **옥타브별 전략**:
  - 저음(≤O4): 타이 무제한 (음 안 씹힘)
  - 고음(O5): 타이 2개까지 (씹힘 방지)
  - 초고음(≥O6): 근사치 사용 (타이 최소화)
- 결과: 원본에 가장 가까운 변환, 글자수 증가

#### 4. 글자수 제한 처리

- 이진 탐색으로 최대 end_time 찾기
- 모든 voice가 char_limit 이하가 되는 지점까지 크롭
- Grid 단위(24 ticks) 정렬로 음표 잘림 방지

### 개발 환경 설정

```bash
npm install
npm run tauri dev      # 개발 모드 (Hot Reload)
npm run tauri build    # 프로덕션 빌드
```

빌드 결과: `src-tauri/target/release/bundle/nsis/*.exe`

### 라이선스

MIT License

</details>

---

**Made with ❤️ for Mobinogi Players**
